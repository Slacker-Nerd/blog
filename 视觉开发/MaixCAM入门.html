<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、MaixCAM 介绍 | 电子摆烂仔</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/assets/favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/blog/assets/favicon/apple-touch-icon.png" type="image/png" sizes="32x32">
    <link rel="apple-touch-icon" href="/blog/apple-touch-icon.png" sizes="180x180">
    <meta name="description" content="我的个人博客">
    <meta name="msapplication-TileImage" content="/favicon.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    
    <link rel="preload" href="/blog/assets/css/0.styles.d706b6c5.css" as="style"><link rel="preload" href="/blog/assets/js/app.34859d9e.js" as="script"><link rel="preload" href="/blog/assets/js/2.d5f36d5e.js" as="script"><link rel="preload" href="/blog/assets/js/1.742c0da7.js" as="script"><link rel="preload" href="/blog/assets/js/41.05f69162.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f8a03e97.js"><link rel="prefetch" href="/blog/assets/js/11.9a5b10d8.js"><link rel="prefetch" href="/blog/assets/js/12.2db62e07.js"><link rel="prefetch" href="/blog/assets/js/13.9e308d15.js"><link rel="prefetch" href="/blog/assets/js/14.9ef79942.js"><link rel="prefetch" href="/blog/assets/js/15.07a74950.js"><link rel="prefetch" href="/blog/assets/js/16.41aec8fb.js"><link rel="prefetch" href="/blog/assets/js/17.d4fb9512.js"><link rel="prefetch" href="/blog/assets/js/18.df371898.js"><link rel="prefetch" href="/blog/assets/js/19.60958448.js"><link rel="prefetch" href="/blog/assets/js/20.4352d5d9.js"><link rel="prefetch" href="/blog/assets/js/21.56e1de6b.js"><link rel="prefetch" href="/blog/assets/js/22.93f71a7e.js"><link rel="prefetch" href="/blog/assets/js/23.7735a173.js"><link rel="prefetch" href="/blog/assets/js/24.808f959c.js"><link rel="prefetch" href="/blog/assets/js/25.342745fd.js"><link rel="prefetch" href="/blog/assets/js/26.14cce030.js"><link rel="prefetch" href="/blog/assets/js/27.632e0b2d.js"><link rel="prefetch" href="/blog/assets/js/28.386e799b.js"><link rel="prefetch" href="/blog/assets/js/29.1db6e815.js"><link rel="prefetch" href="/blog/assets/js/3.3db155a6.js"><link rel="prefetch" href="/blog/assets/js/30.935d4601.js"><link rel="prefetch" href="/blog/assets/js/31.e758558c.js"><link rel="prefetch" href="/blog/assets/js/32.12bd210c.js"><link rel="prefetch" href="/blog/assets/js/33.948c3a43.js"><link rel="prefetch" href="/blog/assets/js/34.0f54fdd0.js"><link rel="prefetch" href="/blog/assets/js/35.7a77d732.js"><link rel="prefetch" href="/blog/assets/js/36.ef39df1e.js"><link rel="prefetch" href="/blog/assets/js/37.dc4f1d69.js"><link rel="prefetch" href="/blog/assets/js/38.95d9c8b2.js"><link rel="prefetch" href="/blog/assets/js/39.c430efa2.js"><link rel="prefetch" href="/blog/assets/js/4.edb3bcae.js"><link rel="prefetch" href="/blog/assets/js/40.df4a8c20.js"><link rel="prefetch" href="/blog/assets/js/42.c0cee6ea.js"><link rel="prefetch" href="/blog/assets/js/43.39f32fa8.js"><link rel="prefetch" href="/blog/assets/js/5.bb26f715.js"><link rel="prefetch" href="/blog/assets/js/6.885334ae.js"><link rel="prefetch" href="/blog/assets/js/7.5cd83934.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.a07464bc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.d706b6c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/img/logo.jpg" alt="电子摆烂仔" class="logo"> <span class="site-name can-hide">电子摆烂仔</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.cnblogs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://oshwhub.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  嘉立创开源硬件平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.csdn.net/?spm=1018.2226.3001.4476" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSND网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.cnblogs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://oshwhub.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  嘉立创开源硬件平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.csdn.net/?spm=1018.2226.3001.4476" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSND网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/视觉开发/" class="sidebar-heading clickable open"><span>视觉开发</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/视觉开发/视觉基础.html" class="sidebar-link">视觉基础</a></li><li><a href="/blog/视觉开发/MaixCAM入门.html" class="active sidebar-link">MaixCAM入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_1-1-上电开机" class="sidebar-link">1.1 上电开机</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_1-2-联网-不可跳过" class="sidebar-link">1.2 联网（不可跳过）</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_1-3-更改语言-如需要" class="sidebar-link">1.3 更改语言（如需要）</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_2-1-maixvision-开发环境安装" class="sidebar-link">2.1 MaixVision 开发环境安装</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_2-2-连接-maixcam-pro" class="sidebar-link">2.2 连接 MaixCAM Pro</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_1-python-编程环境" class="sidebar-link">1. Python 编程环境</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_2-hello-maix-示例程序" class="sidebar-link">2. hello_maix 示例程序</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_2、颜色识别" class="sidebar-link">2、颜色识别</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_3、形状识别" class="sidebar-link">3、形状识别</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_1、高低电平" class="sidebar-link">1、高低电平</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_2、串口通讯" class="sidebar-link">2、串口通讯</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#_3、跟世界说-你好" class="sidebar-link">3、跟世界说”你好“</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#一、训练模型" class="sidebar-link">一、训练模型</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#二、编写调用代码" class="sidebar-link">二、编写调用代码</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#三、代码打包" class="sidebar-link">三、代码打包</a></li><li class="sidebar-sub-header"><a href="/blog/视觉开发/MaixCAM入门.html#一、编程技巧-此处为简写" class="sidebar-link">一、编程技巧(此处为简写)</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一、maixcam-介绍"><a href="#一、maixcam-介绍" class="header-anchor">#</a> 一、<code>MaixCAM</code> 介绍</h1> <p><code>MaixCAM</code> 其实是一个Linux开发板，简单来说就是内部实际上是一个小电脑，经过 <code>Sipeed</code>公司不断优化底层API才达到如此效果</p> <h1 id="二、第一次连接"><a href="#二、第一次连接" class="header-anchor">#</a> 二、第一次连接</h1> <h2 id="_1-1-上电开机"><a href="#_1-1-上电开机" class="header-anchor">#</a> 1.1 上电开机</h2> <p>请使用 <code>Type-C</code> 数据线为 <code>MaixCAM</code> 设备供电，并等待设备启动。首次通电时，设备将进入功能选择界面（显示为粉红色的齿轮图标，点击即可）。</p> <p><img src="https://wiki.sipeed.com/maixpy/static/image/maixcam_font.png" alt="maixcam_font"></p> <h2 id="_1-2-联网-不可跳过"><a href="#_1-2-联网-不可跳过" class="header-anchor">#</a> 1.2 联网（不可跳过）</h2> <p>首次使用时需要连接网络，以便后续激活设备和使用集成开发环境 (IDE)。如果周围没有路由器，可以使用手机开启热点（确保电脑也连接到同一个WiFi网络）。</p> <p>在设备上点击 <code>设置</code>（Settings，即上方的粉红色齿轮图标），然后选择 <code>WiFi</code>。有两种方法可以连接到 <code>WiFi</code> 热点：</p> <ul><li><p><strong>扫描 WiFi 分享码</strong>：</p> <ul><li>使用手机生成并分享 <code>WiFi</code> 热点二维码，或者访问 <a href="https://maixhub.com/wifi" target="_blank" rel="noopener noreferrer">maixhub.com/wifi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 生成一个二维码。</li> <li>点击 <code>扫描二维码</code> 按钮，摄像头画面将出现，对准生成的二维码进行扫描以完成连接。</li></ul></li> <li><p><strong>搜索热点</strong>：</p> <ul><li>点击 <code>扫描</code> 按钮开始搜索周围的 <code>WiFi</code> 网络。您可以多次点击刷新列表以查找更多可用网络。</li> <li>找到您的 <code>WiFi</code> 热点后，输入密码并点击 <code>连接</code> 按钮完成连接。</li></ul></li></ul> <h2 id="_1-3-更改语言-如需要"><a href="#_1-3-更改语言-如需要" class="header-anchor">#</a> 1.3 更改语言（如需要）</h2> <p>如需更改语言设置，请进入 <code>设置</code>（Settings，即上方的粉红色齿轮图标），找到语言选项并进行选择。默认情况下，系统语言为英文。</p> <h2 id="_2-1-maixvision-开发环境安装"><a href="#_2-1-maixvision-开发环境安装" class="header-anchor">#</a> 2.1 MaixVision 开发环境安装</h2> <p>按照安装向导提示操作，直至完成安装过程。整个过程中无需特别注意任何步骤。安装完成后，界面应如下图所示：
<img src="/blog/assets/img/MaixCAM/image-20241111085330171.png" alt="img"></p> <h2 id="_2-2-连接-maixcam-pro"><a href="#_2-2-连接-maixcam-pro" class="header-anchor">#</a> 2.2 连接 MaixCAM Pro</h2> <p>确保电脑与设备处于同一局域网内后，点击右下角从下往上数第三个小电脑图案，再点击“连接”。若连接成功后设备屏幕变黑，则表示已成功建立连接（注意：该设备工作原理较为复杂，但只要电脑和设备在同一网络环境下，即使没有数据线连接也能正常工作)。
<img src="/blog/assets/img/MaixCAM/image-20241111085520218.png" alt="img"></p> <h1 id="三、开始学习使用"><a href="#三、开始学习使用" class="header-anchor">#</a> 三、开始学习使用</h1> <h2 id="_1-python-编程环境"><a href="#_1-python-编程环境" class="header-anchor">#</a> 1. Python 编程环境</h2> <p>Maixcam Pro 属于计算机视觉领域，而非机器视觉。因此，这款设备本质上是一台小型电脑，而不是单片机。这意味着它能够直接运行 Python 代码。不过，该设备内置了一些特定的库（如 <code>camera</code>, <code>display</code>, <code>app</code> 等），这些库在标准的 Python 环境中是无法使用的。此外，所有代码都在设备上执行，而不是在您的电脑上运行。例如，如果代码涉及文件操作，那么路径应指向设备内部的文件系统。</p> <h2 id="_2-hello-maix-示例程序"><a href="#_2-hello-maix-示例程序" class="header-anchor">#</a> 2. <code>hello_maix</code> 示例程序</h2> <p>这是一个基础的示例程序，用于在屏幕上显示摄像头捕获的颜色数据。</p> <ul><li><strong>第一行</strong>：导入所需的库（每次编写程序时都需要这样做）。</li> <li><strong>第三行</strong>：配置摄像头，<code>cam = camera.Camera(512, 320)</code> 设置摄像头读取数据的分辨率为 <code>512x320</code> 像素。请注意，并非分辨率越高越好；过高的分辨率会增加设备的处理负担，导致性能下降甚至出现卡顿现象。</li> <li><strong>第四行</strong>：启动显示屏，<code>disp = display.Display()</code> 确保屏幕处于开启状态。如果不使用此命令，则屏幕不会自动开启。</li> <li><strong>第七行</strong>：进入一个无限循环，防止程序只执行一次后就退出。</li> <li><strong>第八行</strong>：从摄像头读取一帧图像数据。</li> <li><strong>第九行</strong>：将捕获到的图像显示在屏幕上。</li> <li><strong>第十至十一行</strong>：这两行代码用于测量并显示帧率信息。由于每拍完一张照片后立即显示在屏幕上，因此帧间间隔时间越短，表示设备的性能越高。然而，在实际应用中，这部分功能通常不是必需的，并且可能会稍微增加计算开销。</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> camera<span class="token punctuation">,</span> display<span class="token punctuation">,</span> app<span class="token punctuation">,</span> time

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token comment"># 初始化相机，设置分辨率为 512x320</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 初始化显示屏</span>

<span class="token comment"># 主循环，直到退出程序</span>
<span class="token keyword">while</span> <span class="token keyword">not</span> app<span class="token punctuation">.</span>need_exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 从相机获取一帧图像，img 是 maix.image.Image 类型的对象</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token comment"># 将图像显示到屏幕上</span>
    fps <span class="token operator">=</span> time<span class="token punctuation">.</span>fps<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 计算当前帧率（FPS）  </span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token number">1000</span><span class="token operator">/</span>fps<span class="token punctuation">:</span><span class="token format-spec">.02f</span><span class="token punctuation">}</span></span><span class="token string">ms, fps: </span><span class="token interpolation"><span class="token punctuation">{</span>fps<span class="token punctuation">:</span><span class="token format-spec">.02f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment"># 打印每帧的时间间隔（毫秒）和帧率（FPS）</span>
</code></pre></div><h2 id="_2、颜色识别"><a href="#_2、颜色识别" class="header-anchor">#</a> 2、颜色识别</h2> <p>现在我们需要加快进度，目标是识别红绿灯以及水坑。换句话说，我们要判断摄像头视野中是否出现红色（不允许通过）、绿色（允许通过）和蓝色（水坑）。一旦识别出这些颜色，我们将执行相应的操作。</p> <h3 id="_2-1-寻找单个颜色"><a href="#_2-1-寻找单个颜色" class="header-anchor">#</a> 2.1 寻找单个颜色</h3> <p>我们从最简单的情况开始，看看摄像头中是否出现红色。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

thresholds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> blobs<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_GREEN<span class="token punctuation">)</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><p>运行上述代码后的效果如下：
<img src="/blog/assets/img/MaixCAM/image-20241111105316065.png" alt="img"></p> <h4 id="新出现的代码解释"><a href="#新出现的代码解释" class="header-anchor">#</a> 新出现的代码解释</h4> <ol><li><p><strong><code>thresholds = [[0, 80, 40, 80, 10, 80]]</code></strong>：这是红色的数据，即所谓的 LAB 色彩空间。通常 LAB 色彩空间有三个值，但这里使用了六个值。这是因为环境会变化，如果只有三个精确的值，那么稍有变化就会失效。而我们提供的是 LAB 色彩空间的三个范围，每两个为一组，决定最大最小值，只要同时满足这三个范围就能识别出目标颜色。</p></li> <li><p><strong><code>blobs = img.find_blobs(thresholds, pixels_threshold=500)</code></strong>：在拍摄的照片 <code>img</code> 中寻找满足 <code>thresholds</code> 范围的区域，并过滤掉可能出现的颜色杂点（像素数小于 <code>pixels_threshold=500</code>），此时 <code>blobs</code> 是一个包含多个结果的变量。之所以使用复数形式，是因为可能会出现多个符合条件的区域。</p></li> <li><p><strong><code>img.draw_rect(blob[0], blob[1], blob[2], blob[3], image.COLOR_GREEN)</code></strong>：在图片上绘制矩形框以辅助查看。虽然这一步不重要，但它有助于确认识别结果。需要注意的是，<code>blob[i]</code> 的含义：<code>blob[0]</code> 是色块左上角的 x 坐标，<code>blob[1]</code> 是色块左上角的 y 坐标，<code>blob[2]</code> 是色块的宽度 w，<code>blob[3]</code> 是色块的高度 h。</p></li></ol> <h3 id="_2-2-寻找多色块"><a href="#_2-2-寻找多色块" class="header-anchor">#</a> 2.2 寻找多色块</h3> <p>由于我们需要检测三种颜色（红色、绿色和蓝色），我们需要重复上述步骤三次。虽然有更简单的方法，但为了逐步实现，我们先这样做。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 定义红色、绿色和蓝色的颜色阈值</span>
red_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
green_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
blue_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 寻找红色区域并绘制红色矩形框</span>
    red_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>red_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> red_blobs<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_RED<span class="token punctuation">)</span>
    
    <span class="token comment"># 寻找绿色区域并绘制绿色矩形框</span>
    green_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>green_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> green_blobs<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_GREEN<span class="token punctuation">)</span>
    
    <span class="token comment"># 寻找蓝色区域并绘制蓝色矩形框</span>
    blue_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>blue_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> blue_blobs<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_BLUE<span class="token punctuation">)</span>
    
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><p>在这段代码中，没有新出现的部分，但我们还需要了解 <code>thresholds</code> 的数据来源。接下来，表演时间，(#^.^#)</p> <p>第一步：向下滑动，找到图片右下角的“Find blobs”选项并点击。</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241111_115717.jpg" alt="img"></p> <p>如果操作正确，图像将会变成如下所示（如果没有错的话，那就没错了，如果错了就错了）：</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241111_115725.jpg" alt="img"> <img src="" alt="IMG_20241111_115725" style="zoom:25%;"></p> <p>第二步：点击左下角的三条横线，界面上方会出现一行黑色区域。在图像中点击您需要的颜色，相应的数值将会显示出来（点击的位置会有一个白点）。最多可以添加三次颜色数据，超过三次会被覆盖。</p> <img src="/blog/assets/img/MaixCAM/IMG_20241111_115810.jpg" alt="IMG_20241111_115810" style="zoom:25%;"> <p>第三步：如果您想验证自己的数据是否正确，请点击左侧的相应选项，系统会在图像中进行查找和匹配。</p> <img src="/blog/assets/img/MaixCAM/IMG_20241111_115829.jpg" alt="IMG_20241111_115829" style="zoom:25%;"> <p>至此，颜色识别部分的操作流程介绍完毕。接下来我们将学习其他内容（后面还会回来的）。</p> <h2 id="_3、形状识别"><a href="#_3、形状识别" class="header-anchor">#</a> 3、形状识别</h2> <h3 id="_3-1原理"><a href="#_3-1原理" class="header-anchor">#</a> 3.1原理</h3> <p>颜色识别的原理其实不难理解，简单来说就是检查图像中是否有足够多的像素点在X轴或Y轴方向上满足特定的阈值条件。如果这些符合条件的点的数量超过了预设的最小值，则认为该区域被成功标记出来。当然，除了这个基本参数外，还有其他一些影响因素，比如与之相对的最大范围限制。这也解释了为什么在某些情况下，并非摄像头分辨率越高越好——过高的分辨率可能会导致计算量过大而影响效率。</p> <p>至于形状识别，则涉及到更复杂的数学概念，如平面直角坐标系、函数拟合以及方差分析等。具体来说，我们首先从色块边缘提取出关键点，然后尝试用预先定义好的函数模型去拟合这些点。通过计算实际数据与理论模型之间的差异（即方差），来判断是否达到了预期的匹配程度。只有当误差控制在可接受范围内时，才会认为找到了目标形状。</p> <p>接下来我们将学习三种基本的图形识别方法：最简单的直线检测、由四条直线构成的矩形检测，以及本次重点内容——圆形检测</p> <h3 id="_3-2直线识别"><a href="#_3-2直线识别" class="header-anchor">#</a> 3.2直线识别</h3> <p>废话不多说，先上代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化相机</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># 初始化显示</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 从相机读取图像</span>

    <span class="token comment"># 寻找图像中的直线</span>
    lines <span class="token operator">=</span> img<span class="token punctuation">.</span>find_lines<span class="token punctuation">(</span>
        roi<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token comment"># 感兴趣区域，留空表示全图</span>
        x_stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>            <span class="token comment"># 水平步长</span>
        y_stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>            <span class="token comment"># 垂直步长</span>
        threshold<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>        <span class="token comment"># 阈值，越高要求越严格</span>
        theta_margin<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span>       <span class="token comment"># 角度容忍度</span>
        rho_margin<span class="token operator">=</span><span class="token number">25</span>          <span class="token comment"># 距离容忍度</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 如果找到了直线</span>
    <span class="token keyword">if</span> lines<span class="token punctuation">:</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            <span class="token comment"># 绘制直线</span>
            img<span class="token punctuation">.</span>draw_line<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_RED<span class="token punctuation">)</span>

    <span class="token comment"># 将图像显示到屏幕上</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>

</code></pre></div><p>运行效果如右：<img src="/blog/assets/img/MaixCAM/989b562bc6dac0024a0a9b22f97dae1.jpg" alt="989b562bc6dac0024a0a9b22f97dae1" style="zoom:25%;"></p> <p>在此处补充一个python语法，<code>bool类型</code>中我们常说只有True和False两个，但其实不然，还有两种说法</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR<span class="token punctuation">;</span>
	bool<span class="token arrow operator">--&gt;</span>ture<span class="token arrow operator">--&gt;</span>不为零或不为空
	bool<span class="token arrow operator">--&gt;</span>False<span class="token arrow operator">--&gt;</span>零或空
</code></pre></div><p>折回来看一下代码与最开始的 <code>hello_maix</code>相比多了两段分别是 <strong>寻找直线</strong>与 <strong>找到了直线</strong></p> <h4 id="a、寻找直线"><a href="#a、寻找直线" class="header-anchor">#</a> a、寻找直线</h4> <p>在此处函数我们填入了六个参数以及含义分别是</p> <ul><li><code>roi</code> ：识别哪块区域，可以先规定识别哪块区域，其余部分不识别，可以加快运行效率，不填的话就识别全部画面</li> <li><code>x_stride</code>：水平方向的步长，决定了检测直线时的采样间隔。</li> <li><code>y_stride</code>：垂直方向的步长，决定了检测直线时的采样间隔。</li> <li><code>threshold</code>：用于确定直线检测的阈值，值越高，检测到的直线越少，但更精确。</li> <li><code>theta_margin</code>：角度容忍度，允许的角度误差范围。</li> <li><code>rho_margin</code>：距离容忍度，允许的距离误差范围。</li></ul> <h4 id="b、找到了直线"><a href="#b、找到了直线" class="header-anchor">#</a> b、找到了直线</h4> <p>如果没有知道直线那么<code>lines</code>就是空，也就不会执行画线，如果有的话就会进行绘制直线，而<code>line[i]</code>的数据分别是</p> <ul><li><code>line[0]</code> 是直线的起点 x 坐标。</li> <li><code>line[1]</code> 是直线的起点 y 坐标。</li> <li><code>line[2]</code> 是直线的终点 x 坐标。</li> <li><code>line[3]</code> 是直线的终点 y 坐标。</li></ul> <h3 id="_3-3、矩形识别"><a href="#_3-3、矩形识别" class="header-anchor">#</a> 3.3、矩形识别</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

<span class="token comment"># 初始化相机和显示</span>
cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从相机读取图像</span>

    <span class="token comment"># 寻找图像中的矩形</span>
    rects <span class="token operator">=</span> img<span class="token punctuation">.</span>find_rects<span class="token punctuation">(</span>
        roi<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token comment"># 感兴趣区域，留空表示全图</span>
        threshold<span class="token operator">=</span><span class="token number">5000</span>        <span class="token comment"># 阈值，越高要求越严格</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 如果找到了矩形</span>
    <span class="token keyword">if</span> rects<span class="token punctuation">:</span>
        <span class="token keyword">for</span> rect <span class="token keyword">in</span> rects<span class="token punctuation">:</span>
            <span class="token comment"># 绘制矩形，rect 是一个包含四个坐标的元组 (x, y, w, h)</span>
            img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_RED<span class="token punctuation">)</span>

    <span class="token comment"># 将图像显示到屏幕上</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><p>运行效果如下</p> <p><img src="/blog/assets/img/MaixCAM/cb91c6dfb2829599c4b6908cbea40e3.jpg" alt="cb91c6dfb2829599c4b6908cbea40e3"></p> <p>上面的代码就是识别矩形的，仔细看就会发现他只有两个参数，不够精准，只要类似是矩形都会识别到，那怎么办呢，那我们改造一下让他只识别我们指定范围大小的矩形</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

<span class="token comment"># 初始化相机和显示</span>
cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 设置矩形的最小和最大面积</span>
min_area <span class="token operator">=</span> <span class="token number">8000</span>  <span class="token comment"># 最小面积</span>
max_area <span class="token operator">=</span> <span class="token number">100000</span>  <span class="token comment"># 最大面积</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从相机读取图像</span>

    <span class="token comment"># 寻找图像中的矩形</span>
    rects <span class="token operator">=</span> img<span class="token punctuation">.</span>find_rects<span class="token punctuation">(</span>
        roi<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token comment"># 感兴趣区域，留空表示全图</span>
        threshold<span class="token operator">=</span><span class="token number">4000</span>        <span class="token comment"># 阈值，越高要求越严格</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 如果找到了矩形</span>
    <span class="token keyword">if</span> rects<span class="token punctuation">:</span>
        <span class="token keyword">for</span> rect <span class="token keyword">in</span> rects<span class="token punctuation">:</span>
            area <span class="token operator">=</span> rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span> rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>       <span class="token comment"># 计算矩形的面积</span>

            <span class="token comment"># 过滤矩形，根据面积限制</span>
            <span class="token keyword">if</span> min_area <span class="token operator">&lt;=</span> area <span class="token operator">&lt;=</span> max_area<span class="token punctuation">:</span>
                <span class="token comment"># 绘制符合条件的矩形</span>
                img<span class="token punctuation">.</span>draw_rect<span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>image<span class="token punctuation">.</span>COLOR_RED<span class="token punctuation">)</span>

    <span class="token comment"># 将图像显示到屏幕上</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>

</code></pre></div><p>运行效果如下
<img src="/blog/assets/img/MaixCAM/5c2039c5c1af8fc4a2c483edbe376c3.jpg" alt="5c2039c5c1af8fc4a2c483edbe376c3"></p> <p>我们就完成了规定形状的识别，重点是还提高了精准性</p> <h3 id="_3-4、圆形识别"><a href="#_3-4、圆形识别" class="header-anchor">#</a> 3.4、圆形识别</h3> <p>现在到了重头戏，识别圆形，这个代码的参数比较多，所以各位要有点耐心</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 寻找圆形，调整为正确的参数格式</span>
    circles <span class="token operator">=</span> img<span class="token punctuation">.</span>find_circles<span class="token punctuation">(</span>
        roi<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>               <span class="token comment"># 这里是感兴趣区域，传递空列表表示全图</span>
        x_stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>           <span class="token comment"># 水平步长</span>
        y_stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>           <span class="token comment"># 垂直步长</span>
        threshold<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>       <span class="token comment"># 阈值，越高越严格</span>
        x_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment"># x轴偏移量</span>
        y_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment"># y轴偏移量</span>
        r_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment"># 半径的偏移量</span>
        r_min<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>             <span class="token comment"># 最小半径</span>
        r_max<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>             <span class="token comment"># 最大半径</span>
        r_step<span class="token operator">=</span><span class="token number">2</span>              <span class="token comment"># 半径步长</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 如果找到了圆形</span>
    <span class="token keyword">if</span> circles<span class="token punctuation">:</span>
        <span class="token keyword">for</span> circle <span class="token keyword">in</span> circles<span class="token punctuation">:</span>
            <span class="token comment"># 获取圆形的实际位置和半径</span>
            x <span class="token operator">=</span> circle<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 获取 x 坐标</span>
            y <span class="token operator">=</span> circle<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 获取 y 坐标</span>
            r <span class="token operator">=</span> circle<span class="token punctuation">.</span>r<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 获取半径</span>

            <span class="token comment"># 绘制圆形</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r<span class="token punctuation">,</span> image<span class="token punctuation">.</span>COLOR_RED<span class="token punctuation">)</span>

    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>

</code></pre></div><p>效果如下<img src="/blog/assets/img/MaixCAM/50f39bbd0dc0744d8e8b12f1846e9bd.jpg" alt="50f39bbd0dc0744d8e8b12f1846e9bd"></p> <p>这次我们不对参数进行过多的说明，（提示：椭圆也算圆），但我们要思考为什么我们要学习形状识别，理由如下：</p> <ol><li>在后面如果需要使用到训练模型本身与形状识别相识</li> <li>因为如果只识别红色会出现非常尴尬的情况，比如有人穿了红色衣服</li></ol> <p>所以我们要多做一件事器，我们不仅要识别红色，而是要识别红色的圆。首先我们将上面的代码变成一个子函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

<span class="token comment"># 初始化相机和显示器</span>
cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">find_circle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 寻找圆形，调整为正确的参数格式</span>
    circles <span class="token operator">=</span> img<span class="token punctuation">.</span>find_circles<span class="token punctuation">(</span>
        roi<span class="token operator">=</span>kongjian<span class="token punctuation">,</span>               <span class="token comment"># 这里是感兴趣区域，传递空列表表示全图</span>
        x_stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>                 <span class="token comment"># 水平步长</span>
        y_stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>                 <span class="token comment"># 垂直步长</span>
        threshold<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>             <span class="token comment"># 阈值，越高越严格</span>
        x_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># x轴偏移量</span>
        y_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># y轴偏移量</span>
        r_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># 半径的偏移量</span>
        r_min<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>                   <span class="token comment"># 最小半径</span>
        r_max<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>                   <span class="token comment"># 最大半径</span>
        r_step<span class="token operator">=</span><span class="token number">2</span>                    <span class="token comment"># 半径步长</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment"># 如果找到了圆形</span>
    <span class="token keyword">if</span> circles<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从相机读取图像</span>

    <span class="token keyword">if</span> find_circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;找到圆了\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;没找到圆\n&quot;</span><span class="token punctuation">)</span>
    
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># 显示图像</span>
</code></pre></div><h3 id="_3-5、代码融合"><a href="#_3-5、代码融合" class="header-anchor">#</a> 3.5、代码融合</h3> <h4 id="_3-5-1、找红色的圆"><a href="#_3-5-1、找红色的圆" class="header-anchor">#</a> 3.5.1、找红色的圆</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

<span class="token comment"># 初始化相机和显示器</span>
cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 定义颜色阈值</span>
thresholds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">find_circle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    circles <span class="token operator">=</span> img<span class="token punctuation">.</span>find_circles<span class="token punctuation">(</span>
        roi<span class="token operator">=</span>kongjian<span class="token punctuation">,</span>               <span class="token comment"># 这里是感兴趣区域，传递空列表表示全图</span>
        x_stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>                 <span class="token comment"># 水平步长</span>
        y_stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>                 <span class="token comment"># 垂直步长</span>
        threshold<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>             <span class="token comment"># 阈值，越高越严格</span>
        x_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># x轴偏移量</span>
        y_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># y轴偏移量</span>
        r_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># 半径的偏移量</span>
        r_min<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>                   <span class="token comment"># 最小半径</span>
        r_max<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>                   <span class="token comment"># 最大半径</span>
        r_step<span class="token operator">=</span><span class="token number">2</span>                    <span class="token comment"># 半径步长</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment"># 如果找到了圆形</span>
    <span class="token keyword">if</span> circles<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从相机读取图像</span>
    blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>  <span class="token comment"># 找到指定颜色的斑点</span>
    
    <span class="token comment"># 遍历找到的斑点</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> blobs<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出现了红色&quot;</span><span class="token punctuation">)</span> 
        <span class="token keyword">if</span> find_circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出现了红灯\n&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;找不到圆形\n&quot;</span><span class="token punctuation">)</span>
            
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># 显示图像</span>
</code></pre></div><h4 id="_3-5-2、找多种颜色的圆"><a href="#_3-5-2、找多种颜色的圆" class="header-anchor">#</a> 3.5.2、找多种颜色的圆</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> image<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> display

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 红色、绿色、蓝色的颜色阈值</span>
red_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
green_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
blue_threshold <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">find_circle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    circles <span class="token operator">=</span> img<span class="token punctuation">.</span>find_circles<span class="token punctuation">(</span>
        roi<span class="token operator">=</span>kongjian<span class="token punctuation">,</span>               <span class="token comment"># 这里是感兴趣区域，传递空列表表示全图</span>
        x_stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>                 <span class="token comment"># 水平步长</span>
        y_stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>                 <span class="token comment"># 垂直步长</span>
        threshold<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>             <span class="token comment"># 阈值，越高越严格</span>
        x_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># x轴偏移量</span>
        y_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># y轴偏移量</span>
        r_margin<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                <span class="token comment"># 半径的偏移量</span>
        r_min<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>                   <span class="token comment"># 最小半径</span>
        r_max<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>                   <span class="token comment"># 最大半径</span>
        r_step<span class="token operator">=</span><span class="token number">2</span>                    <span class="token comment"># 半径步长</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment"># 如果找到了圆形</span>
    <span class="token keyword">if</span> circles<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    red_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>red_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> red_blobs<span class="token punctuation">:</span>
        <span class="token keyword">if</span> find_circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出现了红灯\n&quot;</span><span class="token punctuation">)</span>
    
    green_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>green_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> green_blobs<span class="token punctuation">:</span>
        <span class="token keyword">if</span> find_circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出现了绿灯\n&quot;</span><span class="token punctuation">)</span>
    
    blue_blobs <span class="token operator">=</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>blue_threshold<span class="token punctuation">,</span> pixels_threshold<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> blob <span class="token keyword">in</span> blue_blobs<span class="token punctuation">:</span>
       <span class="token keyword">if</span> find_circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kongjian<span class="token operator">=</span><span class="token punctuation">[</span>blob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> blob<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出现了水坑\n&quot;</span><span class="token punctuation">)</span>
    
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><h1 id="四、连接外部设备"><a href="#四、连接外部设备" class="header-anchor">#</a> 四、连接外部设备</h1> <p>因为MaixCAM Pro目前不具备语音合成功能，那么只能连接外部设备进行使用，所以我们需要学习一些嵌入式的知识</p> <h2 id="_1、高低电平"><a href="#_1、高低电平" class="header-anchor">#</a> 1、高低电平</h2> <p>有一个有趣的故事讲述了外星人访问地球并与各国建立了友好关系。当这些外星访客准备返回自己的星球时，地球上的国家纷纷赠送了大量的书籍作为礼物。然而，面对如此庞大的知识宝库，外星人发现他们的飞船没有足够的空间来装载所有这些纸质资料。于是，他们采用了一种巧妙的方法：利用纳米技术在一根铁棒上刻下代表二进制中“1”和“0”的划痕与点位，从而用这种紧凑的形式带走了所有重要的信息。</p> <p>这个故事揭示了一个重要事实——信息可以通过二进制代码进行表示。在计算机科学领域，ASCII（美国标准信息交换码）表就是一个典型例子，它使用7位或8位的二进制数来表示英文字母和其他字符。但是，在物理层面上，如何让两台机器通过电线直接交流呢？答案很简单：通过设置不同的电压水平来实现。具体来说，当导线连接到电源的负极时产生低电平，这被定义为逻辑上的“0”；相反地，当同一导线连接到正极时形成高电平，则表示逻辑上的“1”。这样一来，即使是最基础的电子设备也能够借助于简单的高低电平变化完成复杂的数据交换过程。</p> <h2 id="_2、串口通讯"><a href="#_2、串口通讯" class="header-anchor">#</a> 2、串口通讯</h2> <p>串口通讯是两个电子设备之间进行数据传输的一种方式。在理解串口通讯时，有几个关键概念需要掌握：接收（RX）、发送（TX）、波特率以及共地。</p> <ul><li><strong>接收（RX）</strong>：可以形象地比喻为“耳朵”，它负责从另一台设备那里接收信号。</li> <li><strong>发送（TX）</strong>：“嘴巴”的角色，用于向另一台设备发送数据。</li> <li><strong>波特率</strong>：这指的是信息传输的速度，即每秒钟可以传输多少位的数据。为了保证通信双方能够正确地交换信息，两台设备的波特率必须设置成相同。</li> <li><strong>共地</strong>：这意味着将两台设备的负极（也称为“地”或GND）连接起来。这样做的目的是为了避免由于不同设备间电位差导致的问题。如果没有良好的共地连接，那么即使一方输出的是高电平信号，在另一方看来也可能因为相对电位较低而被误认为是低电平信号，从而造成通信失败。</li></ul> <p>原理学完后，我们就需要开始进行代码学习</p> <p><img src="/blog/assets/img/MaixCAM/image-20241112115326367.png" alt="image-20241112115326367"></p> <h3 id="_2-1-串口发送与等待"><a href="#_2-1-串口发送与等待" class="header-anchor">#</a> 2.1 串口发送与等待</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> uart

<span class="token comment"># 定义串口设备的路径</span>
device <span class="token operator">=</span> <span class="token string">&quot;/dev/ttyS0&quot;</span>

<span class="token comment"># 创建一个UART对象，指定设备和波特率（115200）</span>
serial <span class="token operator">=</span> uart<span class="token punctuation">.</span>UART<span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>

<span class="token comment"># 向串口发送字符串 &quot;hello world&quot;</span>
serial<span class="token punctuation">.</span>write_str<span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 从串口读取数据，设置超时时间为2000毫秒（2秒）</span>
<span class="token comment"># 如果在2秒内没有接收到数据，将返回空值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;received:&quot;</span><span class="token punctuation">,</span> serial<span class="token punctuation">.</span>read<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>上面的代码属于基础代码，基本上就是听个响，没什么用，所以我们需要进化一下</p> <h3 id="_2-2-串口发送与等待-pro"><a href="#_2-2-串口发送与等待-pro" class="header-anchor">#</a> 2.2 串口发送与等待_Pro</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> uart<span class="token punctuation">,</span> app<span class="token punctuation">,</span> time

<span class="token comment"># 定义接收到数据时的回调函数</span>
<span class="token keyword">def</span> <span class="token function">on_received</span><span class="token punctuation">(</span>serial<span class="token punctuation">:</span> uart<span class="token punctuation">.</span>UART<span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;received:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>  <span class="token comment"># 打印接收到的数据</span>
    serial<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 将接收到的数据原样发送回去</span>

<span class="token comment"># 定义串口设备的路径</span>
device <span class="token operator">=</span> <span class="token string">&quot;/dev/ttyS0&quot;</span>

<span class="token comment"># 创建一个UART对象，指定设备和波特率（115200）</span>
serial <span class="token operator">=</span> uart<span class="token punctuation">.</span>UART<span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>

<span class="token comment"># 设置接收数据时的回调函数</span>
serial<span class="token punctuation">.</span>set_received_callback<span class="token punctuation">(</span>on_received<span class="token punctuation">)</span>

<span class="token comment"># 向串口发送字符串 &quot;hello&quot; 并换行</span>
serial<span class="token punctuation">.</span>write_str<span class="token punctuation">(</span><span class="token string">&quot;hello\r\n&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;sent hello&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 打印发送的信息</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;wait data&quot;</span><span class="token punctuation">)</span>   <span class="token comment"># 打印等待数据的提示</span>

<span class="token comment"># 主循环，直到需要退出应用</span>
<span class="token keyword">while</span> <span class="token keyword">not</span> app<span class="token punctuation">.</span>need_exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 休眠100毫秒，释放CPU资源</span>
</code></pre></div><p>现在我们来解释一下其中的弯弯绕绕</p> <p><strong>什么是回调函数</strong>？</p> <p>回调函数是一种通过函数指针调用的机制。在编程中，回调函数通常用于在某个特定事件发生时执行特定的代码。例如，当一个异步操作完成时，系统会调用预先定义的回调函数来处理结果或进行下一步操作。</p> <p><strong>为什么要用回调函数</strong>？</p> <p>使用回调函数的主要原因是为了提高程序的效率和响应能力。具体来说：</p> <ol><li><strong>避免阻塞</strong>：如果不使用回调函数，程序可能会因为等待某个操作的完成而被阻塞，无法进行其他任务。使用回调函数可以让程序在等待期间继续执行其他任务。</li> <li><strong>异步处理</strong>：回调函数允许程序以异步方式处理事件，这样可以更好地利用系统资源，提高程序的性能。</li></ol> <p><strong>为什么会接收不到信息</strong>？</p> <p>信息的接收可能会受到主线程的影响。为了更好地理解这一点，我们需要先了解什么是主线程。</p> <p><strong>什么是主线程</strong>？</p> <p>主线程是程序执行的主要线程。它是程序启动时创建的第一个线程，负责执行程序的主要逻辑。在我们的例子中，如果我们在写作业，那么我们的主线程就是写作业的过程。</p> <p><strong>主线程与回调函数的关系</strong></p> <p>假设你在写作业的过程中，有朋友叫你出去玩。如果你停下来回复朋友，这就是触发了回调函数，暂时中断了写作业这个主线程的任务。如果你是将回复放在写作业之后，那么在写完作业之前你是无法进行回复的。</p> <p>这种情况下，如果写作业的过程非常耗时，你可能无法及时回复朋友。为了避免这种情况，可以使用回调函数来处理这类异步事件。当朋友叫你出去玩时，你可以立即触发回调函数进行处理，而不必等待写作业完成。这样，你就可以在不中断主线程的情况下，及时响应外部事件。</p> <h2 id="_3、跟世界说-你好"><a href="#_3、跟世界说-你好" class="header-anchor">#</a> 3、跟世界说”你好“</h2> <p>因为时间关系，我们不过多的解释这个语音模块的原理，但我们只需要了解一下怎么使用</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> uart

device <span class="token operator">=</span> <span class="token string">&quot;/dev/ttyS0&quot;</span>
serial <span class="token operator">=</span> uart<span class="token punctuation">.</span>UART<span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">send_tts_message</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gb2312_str<span class="token operator">=</span> message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gb2312'</span><span class="token punctuation">)</span>
    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>gb2312_str<span class="token punctuation">)</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment"># 包括头字节和长度字节</span>
    <span class="token comment"># 填充缓冲区</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xFD</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># cmd byte</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># para byte</span>
    <span class="token comment"># 复制GB2312编码数据</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> gb2312_str
    <span class="token comment"># 发送数据</span>
    serial<span class="token punctuation">.</span>write_str<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>

<span class="token comment"># 主程序</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># 发送测试消息</span>
    test_message <span class="token operator">=</span>  <span class="token string">&quot;你好&quot;</span>
    send_tts_message<span class="token punctuation">(</span>test_message<span class="token punctuation">)</span>
</code></pre></div><p>其实需要修改的地方就一个，没错，就是“你好”，这个语音模块的工作原理和ASCII表差不多，所以我们只需要提前写好格式转换函数就可以了。</p> <h1 id="五、ai视觉"><a href="#五、ai视觉" class="header-anchor">#</a> 五、AI视觉</h1> <h2 id="一、训练模型"><a href="#一、训练模型" class="header-anchor">#</a> 一、训练模型</h2> <p>什么是AI视觉，首先我们回顾一下前面所讲的颜色识别与形状识别，一个是通过寻找颜色，一个是检测颜色的边界是否符合形状函数</p> <p>如果我们将一个物体上的所有颜色比例与边界函数找到，那是不是就可以让物体被机器识别到</p> <p>那我们先借助平台来完成这个任务，其中会涉及到一些术语，需要各位记住</p> <h3 id="a、创建项目"><a href="#a、创建项目" class="header-anchor">#</a> a、创建项目</h3> <p>首先借助Sipeed提供的平台<a href="https://maixhub.com/" target="_blank" rel="noopener noreferrer">MaixHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来完成</p> <h4 id="第一步打开连接进去平台"><a href="#第一步打开连接进去平台" class="header-anchor">#</a> 第一步打开连接进去平台</h4> <p><img src="/blog/assets/img/MaixCAM/image-20241119195433302.png" alt="image-20241119195433302"></p> <h4 id="第二步点击模型训练中的开始训练进入下一个页面"><a href="#第二步点击模型训练中的开始训练进入下一个页面" class="header-anchor">#</a> 第二步点击模型训练中的开始训练进入下一个页面</h4> <p><img src="/blog/assets/img/MaixCAM/image-20241119195655963.png" alt="image-20241119195655963"></p> <h4 id="第三步点击新建训练并填写必要信息"><a href="#第三步点击新建训练并填写必要信息" class="header-anchor">#</a> 第三步点击新建训练并填写必要信息</h4> <p><img src="/blog/assets/img/MaixCAM/image-20241119200016772.png" alt="image-20241119200016772"></p> <p>注意最好选图像检测</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121092655796.png" alt="image-20241121092655796"></p> <p>到此为止项目就建立完成</p> <h3 id="b、采集数据"><a href="#b、采集数据" class="header-anchor">#</a> b、采集数据</h3> <p>第一步点击去准备数据集</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121093242294.png" alt="image-20241121093242294"></p> <p>第二步点击创建数据集（右上角）</p> <p><img src="C:%5CUsers%5Cadmin%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20241121093504806.png" alt="image-20241121093504806"></p> <p>第三步填写必要信息
<img src="/blog/assets/img/MaixCAM/image-20241121093547537.png" alt="image-20241121093547537"></p> <p>第四步点击查看</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121093654105.png" alt="image-20241121093654105"></p> <p>第五步点击左边的设备采集</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121093805049.png" alt="image-20241121093805049"></p> <p>第六步在选择开发板与训练集的情况下点击生成二维码</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121093920378.png" alt="image-20241121093920378"></p> <p>第七步设备下滑找到左上角的这个图标</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094113.jpg" alt="IMG_20241121_094113"></p> <p>第八步点击右下角的确认</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094131.jpg" alt="IMG_20241121_094131"></p> <p>第九步在此页面下去扫描刚才生成的二维码</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094149.jpg" alt=""></p> <p>第十步采集数据</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094256.jpg" alt="IMG_20241121_094256"></p> <p>第十一步上传</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094302.jpg" alt="IMG_20241121_094302"></p> <h3 id="c、标注"><a href="#c、标注" class="header-anchor">#</a> c、标注</h3> <p>在进行标注之前我们需要再了解一下原理，我们刚才有讲到训练模型的原理是找到某个特定的函数，但拍摄的图片不一定全部都是有用的，所以我们就需要标注，拉框</p> <p>第一步点击左下角的标注数据</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121100947759.png" alt="image-20241121100947759"></p> <p>第二步点击新建标注后再点击画面不要松开，框住后松开</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121101157846.png" alt="image-20241121101157846"></p> <p>第三步输入标签名字，尽量英文如果变成淡蓝色就是成功</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121101442029.png" alt="image-20241121101442029"></p> <p>到此就完成了标注</p> <h3 id="d、训练模型"><a href="#d、训练模型" class="header-anchor">#</a> d、训练模型</h3> <p>第一步 全部标记完成后点击总览后再点击右上角的下载</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121102150764.png" alt=""></p> <p>第二步点击导入数据集后点击压缩包将刚才下载的压缩包上传</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121102327134.png" alt="image-20241121102327134"></p> <p>第三步点击开始上传，完成后点击上方的训练模型，再点击数据集</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121102549382.png" alt="image-20241121102549382"></p> <p>第四步点击刚才的采集的训练集再点击确定，直到下方页面</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121102657799.png" alt="image-20241121102657799"></p> <p>第五步点击左边的创建任务，配置如下</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121102955997.png" alt="image-20241121102955997"></p> <p>第六步滑到最下面点击创建训练任务并输入名字</p> <p><img src="C:%5CUsers%5Cadmin%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20241121103118269.png" alt="image-20241121103118269"></p> <p>直到这个界面等待就好</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121103156462.png" alt="image-20241121103156462"></p> <h3 id="e、试验模型"><a href="#e、试验模型" class="header-anchor">#</a> e、试验模型</h3> <p>点击左边的部署模型可以查看到刚才我们训练的模型</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121103929270.png" alt="image-20241121103929270"></p> <p>点击它后再再点击自动部署</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121104034686.png" alt="image-20241121104034686"></p> <p>第二步回到刚才的这个页面点击左下角的功能</p> <p><img src="/blog/assets/img/MaixCAM/IMG_20241121_094131.jpg" alt="IMG_20241121_094131"></p> <p>第三步在部署模型的页面下点击确定<img src="/blog/assets/img/MaixCAM/IMG_20241121_104250.jpg" alt="IMG_20241121_104250"></p> <p>第四步扫描刚才的二维码<img src="/blog/assets/img/MaixCAM/IMG_20241121_104321.jpg" alt="IMG_20241121_104321"></p> <p>第五步验证模型<img src="/blog/assets/img/MaixCAM/IMG_20241121_104408.jpg" alt="IMG_20241121_104408"></p> <p>完美</p> <h2 id="二、编写调用代码"><a href="#二、编写调用代码" class="header-anchor">#</a> 二、编写调用代码</h2> <p>点击手动部署，再点击下载模型</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121105312178.png" alt="image-20241121105312178"></p> <p>在压缩包解压后有一个main.py，再软件中打开</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121105501755.png" alt="image-20241121105501755"></p> <p>下方就是调用基础的代码</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121105545891.png" alt="image-20241121105545891"></p> <p>加入语音合成部分并修改一下</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> camera<span class="token punctuation">,</span> display<span class="token punctuation">,</span> image<span class="token punctuation">,</span> nn<span class="token punctuation">,</span> app<span class="token punctuation">,</span>uart

detector <span class="token operator">=</span> nn<span class="token punctuation">.</span>YOLOv5<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;/root/models/maixhub/162366/model_162366.mud&quot;</span><span class="token punctuation">)</span>

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span>detector<span class="token punctuation">.</span>input_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> detector<span class="token punctuation">.</span>input_height<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> detector<span class="token punctuation">.</span>input_format<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
dis <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

device <span class="token operator">=</span> <span class="token string">&quot;/dev/ttyS0&quot;</span>
serial <span class="token operator">=</span> uart<span class="token punctuation">.</span>UART<span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">send_tts_message</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gb2312_str<span class="token operator">=</span> message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gb2312'</span><span class="token punctuation">)</span>
     

    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>gb2312_str<span class="token punctuation">)</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment"># 包括头字节和长度字节</span>

    <span class="token comment"># 填充缓冲区</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xFD</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># cmd byte</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># para byte</span>

    <span class="token comment"># 复制GB2312编码数据</span>
    <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> gb2312_str

    <span class="token comment"># 发送数据</span>
    serial<span class="token punctuation">.</span>write_str<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>

a_<span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token keyword">not</span> app<span class="token punctuation">.</span>need_exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    objs <span class="token operator">=</span> detector<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>img<span class="token punctuation">,</span> conf_th <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> iou_th <span class="token operator">=</span> <span class="token number">0.45</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> objs<span class="token punctuation">:</span>
        a_<span class="token operator">=</span>a_<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">if</span> a_<span class="token operator">&gt;</span><span class="token number">50</span><span class="token punctuation">:</span>
            test_message <span class="token operator">=</span>  <span class="token string">&quot;绿灯&quot;</span>
            send_tts_message<span class="token punctuation">(</span>test_message<span class="token punctuation">)</span>
            a_<span class="token operator">=</span><span class="token number">0</span>
        
    dis<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><h2 id="三、代码打包"><a href="#三、代码打包" class="header-anchor">#</a> 三、代码打包</h2> <p>第一步点击左下角进入下面的页面</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121110122967.png" alt="image-20241121110122967"></p> <p>第二步填写信息后点击确定</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121110257725.png" alt="image-20241121110257725"></p> <p>第三步 开始打包</p> <p><img src="/blog/assets/img/MaixCAM/image-20241121110335383.png" alt="image-20241121110335383"></p> <p>第四步，点击安装应用</p> <p><img src="C:%5CUsers%5Cadmin%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20241121110440843.png" alt="image-20241121110440843"></p> <p>第五步，断开连接测试</p> <h1 id="六、整合全部代码"><a href="#六、整合全部代码" class="header-anchor">#</a> 六、整合全部代码</h1> <h2 id="一、编程技巧-此处为简写"><a href="#一、编程技巧-此处为简写" class="header-anchor">#</a> 一、编程技巧(此处为简写)</h2> <h3 id="a、多次确定法"><a href="#a、多次确定法" class="header-anchor">#</a> a、多次确定法</h3> <p>有一个小问题，模型本身是具有不确定性的，那有可能会不小心触发，那我们就来一个多次确定，并且也可以进行延时</p> <div class="language-python extra-class"><pre class="language-python"><code>a<span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> objS<span class="token punctuation">:</span>
    	a<span class="token operator">=</span>a<span class="token operator">+</span><span class="token number">1</span>
    	<span class="token keyword">if</span> a<span class="token operator">&gt;</span><span class="token number">100</span>
        	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            a<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><h3 id="b、多次消除法"><a href="#b、多次消除法" class="header-anchor">#</a> b、多次消除法</h3> <p>如果不巧，上方的a多次累计后刚好是99，那只要不小心触发一次就会播报，那我们就需要多个在一段时间没有出现后就去除累计数</p> <div class="language-python extra-class"><pre class="language-python"><code>a<span class="token operator">=</span><span class="token number">0</span>
a_<span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> objS<span class="token punctuation">:</span>
    	a<span class="token operator">=</span>a<span class="token operator">+</span><span class="token number">1</span>
    	a_<span class="token operator">=</span><span class="token number">0</span>
    	<span class="token keyword">if</span> a<span class="token operator">&gt;</span><span class="token number">100</span>
        	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            a<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">else</span> <span class="token punctuation">:</span>
    	a_<span class="token operator">=</span>a_<span class="token operator">+</span><span class="token number">1</span>
    	<span class="token keyword">if</span> a_<span class="token operator">&gt;</span><span class="token number">100</span>
    		a<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><h3 id="c、多线程"><a href="#c、多线程" class="header-anchor">#</a> c、多线程</h3> <p>在之前上课的时候有讲到一个代码里面只能出现一个不可跳出的死循环，那有没有办法多建立一个呢，有的，这个方法就是多线程</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> maix <span class="token keyword">import</span> camera<span class="token punctuation">,</span> display<span class="token punctuation">,</span> app<span class="token punctuation">,</span> time
<span class="token keyword">import</span> threading

cam <span class="token operator">=</span> camera<span class="token punctuation">.</span>Camera<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span>
disp <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">print_ones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>print_ones<span class="token punctuation">)</span>
thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cam<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    disp<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><p>这里着重讲一下，</p> <p>第一步：导入库<code>import threading</code></p> <p>第二步：写一个子函数并放上循环</p> <p>第三步：所有<code>threading.Thread(target=print_ones)</code>调用循环</p> <p>第四步：启动这个循环<code>thread.start()</code></p> <p>注：可以有多个线程</p> <h1 id="七、ai语音"><a href="#七、ai语音" class="header-anchor">#</a> 七、AI语音</h1></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/视觉开发/视觉基础.html" class="prev">
        视觉基础
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.34859d9e.js" defer></script><script src="/blog/assets/js/2.d5f36d5e.js" defer></script><script src="/blog/assets/js/1.742c0da7.js" defer></script><script src="/blog/assets/js/41.05f69162.js" defer></script>
  </body>
</html>
